<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Regresi Linier</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        table {
            border-collapse: collapse;
            margin-top: 15px;
        }
        table, th, td {
            border: 1px solid black;
            padding: 6px 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }

        #grafik-container {
            width: 520px;
            overflow: auto;
            border: 1px solid #ccc;
            padding: 10px;
            transform-origin: top left;
        }
    </style>
</head>
<body>

<h2>Perhitungan Regresi Linier</h2>

<label>Data X (pisahkan dengan koma):</label><br>
<input type="text" id="dataX" placeholder="Contoh: 1,2,3,4,5"><br><br>

<label>Data Y (pisahkan dengan koma):</label><br>
<input type="text" id="dataY" placeholder="Contoh: 2,3,5,4,6"><br><br>

<button onclick="hitung()">Hitung Regresi</button>

<h3>Tabel Perhitungan</h3>
<div id="tabel"></div>

<h3>Hasil Regresi</h3>
<p id="hasil"></p>

<h3>Tabel Nilai Regresi Interpolasi (y = a + bx)</h3>
<div id="tabelRegresi"></div>

<h3>Regresi Ekstrapolasi</h3>
<label>Masukkan nilai x:</label><br>
<input type="number" id="xEkstra">
<button onclick="hitungEkstrapolasi()">Hitung</button>
<p id="hasilEkstra"></p>

<label>Zoom Grafik:</label>
<input type="range" min="50" max="200" value="100" id="zoomSlider">
<span id="zoomValue">100%</span>

<br><br>

<div id="grafik-container">
    <canvas id="grafik" width="800" height="450"></canvas>
</div>

<script>
let chart;
let aGlobal, bGlobal;

function hitung() {
    let x = document.getElementById("dataX").value.split(",").map(Number);
    let y = document.getElementById("dataY").value.split(",").map(Number);

    let n = x.length;
    if (n !== y.length || n < 2) {
        alert("Data minimal 2 dan jumlah X = Y");
        return;
    }

    let sumX = 0, sumY = 0, sumX2 = 0, sumXY = 0;
    let tabelHTML = `
        <table>
        <tr>
            <th>No</th>
            <th>x</th>
            <th>y</th>
            <th>x²</th>
            <th>xy</th>
        </tr>
    `;

    for (let i = 0; i < n; i++) {
        let x2 = x[i] * x[i];
        let xy = x[i] * y[i];

        sumX += x[i];
        sumY += y[i];
        sumX2 += x2;
        sumXY += xy;

        tabelHTML += `
            <tr>
                <td>${i + 1}</td>
                <td>${x[i]}</td>
                <td>${y[i]}</td>
                <td>${x2}</td>
                <td>${xy}</td>
            </tr>
        `;
    }

    tabelHTML += `
        <tr>
            <th>Σ</th>
            <th>${sumX}</th>
            <th>${sumY}</th>
            <th>${sumX2}</th>
            <th>${sumXY}</th>
        </tr>
        </table>
    `;
    document.getElementById("tabel").innerHTML = tabelHTML;

    let b = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
    let a = (sumY - b * sumX) / n;

    aGlobal = a;
    bGlobal = b;

    document.getElementById("hasil").innerHTML =
        "<b>Persamaan regresi:</b><br>" +
        "y = " + a.toFixed(3) + " + " + b.toFixed(3) + "x";

    /* TABEL NILAI REGRESI */
    let tabelRegresi = `
        <table>
        <tr>
            <th>No</th>
            <th>x</th>
            <th>y (hasil regresi)</th>
        </tr>
    `;

    let dataRegresi = [];

    for (let i = 0; i < n; i++) {
        let yReg = a + b * x[i];
        dataRegresi.push({ x: x[i], y: yReg });

        tabelRegresi += `
            <tr>
                <td>${i + 1}</td>
                <td>${x[i]}</td>
                <td>${yReg.toFixed(3)}</td>
            </tr>
        `;
    }

    tabelRegresi += "</table>";
    document.getElementById("tabelRegresi").innerHTML = tabelRegresi;

    /* DATA GRAFIK */
    let dataAsli = x.map((val, i) => ({
        x: val,
        y: y[i]
    }));

    let xMin = Math.min(...x);
    let xMax = Math.max(...x);

    let garisRegresi = [
        { x: xMin, y: a + b * xMin },
        { x: xMax, y: a + b * xMax }
    ];

    if (chart) chart.destroy();

    const ctx = document.getElementById("grafik").getContext("2d");
    chart = new Chart(ctx, {
        type: "scatter",
        data: {
            datasets: [
                {
                    label: "Data Asli",
                    data: dataAsli,
                    backgroundColor: "blue"
                },
                {
                    label: "Titik Hasil Regresi",
                    data: dataRegresi,
                    backgroundColor: "black",
                    pointRadius: 6
                },
                {
                    label: "Garis Regresi Linier",
                    type: "line",
                    data: garisRegresi,
                    borderColor: "red",
                    fill: false
                }
            ]
        },
        options: {
            responsive: false
        }
    });
}

/* EKSTRAPOLASI */
function hitungEkstrapolasi() {
    let xBaru = Number(document.getElementById("xEkstra").value);
    if (isNaN(xBaru)) {
        alert("Masukkan nilai x yang valid");
        return;
    }

    let yEkstra = aGlobal + bGlobal * xBaru;

    document.getElementById("hasilEkstra").innerHTML =
        "<b>Hasil Ekstrapolasi:</b><br>" +
        "Untuk x = " + xBaru + "<br>" +
        "y = " + yEkstra.toFixed(3);
}

/* ZOOM */
const slider = document.getElementById("zoomSlider");
const container = document.getElementById("grafik-container");
const zoomValue = document.getElementById("zoomValue");

slider.addEventListener("input", function () {
    let scale = slider.value / 100;
    container.style.transform = "scale(" + scale + ")";
    zoomValue.innerText = slider.value + "%";
});
</script>

</body>
</html>
