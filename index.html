<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Regresi Linier - Doni Stiawan, S.Mat</title>

<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box; touch-action: manipulation;}
body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    font-family: 'Quicksand', sans-serif;
    background-color: #050a14; color: #333; overflow-x: hidden;
}

/* --- BACKGROUND PARTIKEL --- */
#canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

/* --- HALAMAN VALIDASI MENJEBAK (FIXED FOR MOBILE) --- */
#validation-page {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #050a14; z-index: 9999;
    display: flex; justify-content: center; align-items: center;
}
.val-card {
    background: rgba(15, 23, 42, 0.98); padding: 30px; border-radius: 20px;
    border: 2px solid #ff2f92; width: 90%; max-width: 400px;
    text-align: center; position: relative; min-height: 300px;
}
.val-card h2 { color: #ff2f92; margin-bottom: 15px; }
.val-card p { color: white; margin-bottom: 25px; }

.btn-val-group { position: relative; width: 100%; height: 120px; margin-top: 20px; }
.btn-iya { 
    background: #ff2f92; color: white; padding: 12px 25px; border-radius: 10px; 
    border: none; font-weight: bold; cursor: pointer; font-size: 1.1rem;
}
.btn-tidak { 
    background: #475569; color: white; padding: 12px 20px; border-radius: 10px; 
    border: none; font-weight: bold; cursor: pointer; position: absolute; 
    left: 50%; bottom: 0; transform: translateX(-50%); transition: 0.2s;
}

/* --- MAIN PAGE (KODINGAN ASLI BAPAK DENGAN OPTIMASI MOBILE) --- */
.overlay {
    position: relative; z-index: 10; display: none;
    min-height: 100vh; padding: 20px;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(8px); border-radius: 22px;
    max-width: 1100px; margin: 20px auto;
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.25);
}
.overlay.show { display: block; }

h2{text-align:center;color:#ff2f92;margin-bottom:5px;}
.subjudul{text-align:center;font-weight:bold;margin-bottom:25px;font-size:1.9em;}
.subjudul::after{content:" üìà";}
label{font-weight:600;}

/* Input Adaptif Mobile */
input{width:18%;padding:10px;border-radius:12px;border:1px solid #ccc;font-family:'Quicksand',sans-serif;}
button{
    background:#ff5fa2;color:white;border:none;padding:12px 18px;border-radius:14px;
    cursor:pointer;font-weight:700;box-shadow:0 6px 15px rgba(255,95,162,.5);
}

.table-scroll { width: 100%; overflow-x: auto; margin-top: 15px; border-radius: 14px; }
table{width:100%; border-collapse:collapse; background:white; font-size:1.5em; min-width: 500px;}
th,td{padding:10px;border:1px solid #ddd;text-align:center;}
th{background:#ffe0ef;}

.section{margin-top:25px;padding:18px;background:#fff;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,.12);}
#grafik-container{width:100%;padding:12px;background:black;border-radius:18px;transform-origin:top left;overflow: hidden;}
#hasil{font-size: 2em;font-weight: bold;color: #ff2f92;text-align: center;margin: 10px 0;}

@media(max-width:768px){
    .overlay{margin:10px;padding:15px;}
    input{width:100% !important; margin-bottom:10px; display: block;}
    button{width:100%;}
    .subjudul{font-size: 1.4em;}
    table{font-size: 1.1em;}
}
</style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div id="validation-page">
    <div class="val-card">
        <h2>KONFIRMASI</h2>
        <p>Apakah anda menyukai matematika dan mengakui bahwa <b>Bapak Doni Stiawan</b> adalah Guru Terkeren dan Anda sangat Ganteng?</p>
        <div class="btn-val-group">
            <button class="btn-iya" onclick="prosesIya()">IYA, SETUJU</button>
            <button id="btn-no" class="btn-tidak" 
                onmouseover="moveNo()" 
                onclick="moveNo()" 
                ontouchstart="moveNo()">TIDAK</button>
        </div>
    </div>
</div>

<div class="overlay" id="main-page">
    <h2>Perhitungan Regresi Linier</h2>
    <div class="subjudul">DONI STIAWAN, S.MAT</div>

    <div class="section">
    <h3>üìä Tambah Poin Data</h3>
    <input type="number" id="xPoin" placeholder="x">
    <input type="number" id="yPoin" placeholder="y">
    <button onclick="tambahPoin()">‚ûï Tambah Poin</button>
    <div class="table-scroll" id="tabelPoin"></div>
    <button onclick="hitung()">‚ú® Hitung Regresi ‚ú®</button>
    <button onclick="resetSemua()" style="background:#6b7280;">üîÑ Reset</button>
    </div>

    <div class="section">
    <h3>üìä Tabel Perhitungan</h3>
    <div class="table-scroll" id="tabel"></div>
    </div>

    <div class="section">
    <h3>üí° Hasil Regresi</h3>
    <p id="hasil"></p>
    </div>

    <div class="section">
    <h3>üìà Tabel Nilai Regresi (Interpolasi)</h3>
    <div class="table-scroll" id="tabelRegresi"></div>
    </div>

    <div class="section">
    <h3>üîÆ Ekstrapolasi</h3>
    <input type="number" id="xEkstra" placeholder="Masukkan x">
    <button onclick="tambahkanEkstra()">‚ûï Tambah Ekstrapolasi</button>
    <div class="table-scroll" id="tabelEkstra"></div>
    </div>

    <div class="section">
    <label>üîç Zoom Grafik:</label>
    <input type="range" min="50" max="150" value="50" id="zoomSlider">
    <span id="zoomValue">50%</span>
    <br><br>
    <input type="checkbox" id="showRegression">
    <label for="showRegression">Munculkan Garis Regresi</label>
    <div id="grafik-container">
        <canvas id="grafik" height="320"></canvas>
    </div>
    </div>
</div>

<script>
// --- BACKGROUND (GARIS KUNING) ---
const canvas = document.getElementById('canvas-bg');
const ctx = canvas.getContext('2d');
let particles = [];
function initBG() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    particles = [];
    for (let i = 0; i < 60; i++) {
        particles.push({
            x: Math.random() * canvas.width, y: Math.random() * canvas.height,
            vx: (Math.random() - 0.5) * 1.2, vy: (Math.random() - 0.5) * 1.2
        });
    }
}
function drawBG() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy;
        if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
        if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
        ctx.fillStyle = "#38bdf8"; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        for (let j = i + 1; j < particles.length; j++) {
            let p2 = particles[j];
            let dist = Math.hypot(p.x-p2.x, p.y-p2.y);
            if (dist < 110) {
                ctx.strokeStyle = `rgba(251, 191, 36, ${1 - dist/110})`;
                ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
            }
        }
    });
    requestAnimationFrame(drawBG);
}
initBG(); drawBG(); window.onresize = initBG;

// --- JEBAKAN (FIXED FOR MOBILE) ---
function moveNo() {
    const btnNo = document.getElementById('btn-no');
    const container = document.querySelector('.val-card');
    const maxX = container.clientWidth - btnNo.clientWidth;
    const maxY = container.clientHeight - btnNo.clientHeight - 40;
    const x = Math.random() * maxX;
    const y = Math.random() * maxY;
    btnNo.style.left = x + 'px';
    btnNo.style.top = y + 'px';
    btnNo.style.transform = 'none';
}
function prosesIya() {
    document.getElementById('validation-page').style.display = 'none';
    document.getElementById('main-page').classList.add('show');
}

// --- KODINGAN ASLI BAPAK (TIDAK ADA YANG DIUBAH) ---
let chart, a, b;
let dataX = [], dataY = [];
let ekstrapolasiData = [];
let minX, maxX, minY, maxY, stepSizeX, stepSizeY;

function tambahPoin(){
    let x = Number(document.getElementById("xPoin").value);
    let y = Number(document.getElementById("yPoin").value);
    if(isNaN(x) || isNaN(y)){ alert("Masukkan nilai x dan y yang valid! üå∏"); return; }
    dataX.push(x); dataY.push(y); updateTabelPoin();
    document.getElementById("xPoin").value = ""; document.getElementById("yPoin").value = "";
}

function updateTabelPoin(){
    let tabel = `<table><tr><th>No</th><th>x</th><th>y</th><th>Aksi</th></tr>`;
    dataX.forEach((x, i) => {
        tabel += `<tr><td>${i+1}</td><td>${x}</td><td>${dataY[i]}</td><td><button onclick="hapusPoin(${i})" style="background:#ff2f92;padding:5px 10px;width:auto;">Hapus</button></td></tr>`;
    });
    tabel += `</table>`;
    document.getElementById("tabelPoin").innerHTML = tabel;
}

function hapusPoin(i){
    dataX.splice(i,1); dataY.splice(i,1); updateTabelPoin();
    if(dataX.length>=2) hitung();
    else{ resetGrafikOnly(); }
}

function hitung(){
    if(dataX.length<2){alert("Tambahkan minimal 2 poin data ya! üíï"); return;}
    let x=[...dataX], y=[...dataY], n=x.length;
    let sumX=0,sumY=0,sumX2=0,sumXY=0;
    let tabel=`<table><tr><th>No</th><th>x</th><th>y</th><th>x¬≤</th><th>xy</th></tr>`;
    for(let i=0;i<n;i++){
        let x2=x[i]*x[i], xy=x[i]*y[i];
        sumX+=x[i]; sumY+=y[i]; sumX2+=x2; sumXY+=xy;
        tabel+=`<tr><td>${i+1}</td><td>${x[i]}</td><td>${y[i]}</td><td>${x2}</td><td>${xy}</td></tr>`;
    }
    tabel+=`<tr><th>Œ£</th><th>${sumX}</th><th>${sumY}</th><th>${sumX2}</th><th>${sumXY}</th></tr></table>`;
    document.getElementById("tabel").innerHTML=tabel;

    b=(n*sumXY-sumX*sumY)/(n*sumX2-sumX*sumX);
    a=(sumY-b*sumX)/n;
    document.getElementById("hasil").innerHTML=`‚ú® <b>y=${a.toFixed(3)} + ${b.toFixed(3)}x</b> ‚ú®`;

    let tabelR=`<table><tr><th>x</th><th>y hasil regresi</th></tr>`;
    let titikRegresi=[];
    for(let i=0;i<n;i++){
        let yr=a+b*x[i];
        tabelR+=`<tr><td>${x[i]}</td><td>${yr.toFixed(3)}</td></tr>`;
        titikRegresi.push({x:x[i],y:yr});
    }
    tabelR+=`</table>`;
    document.getElementById("tabelRegresi").innerHTML=tabelR;

    let scatterData=x.map((v,i)=>({x:v,y:y[i]}));
    let allX=[...x,...ekstrapolasiData.map(p=>p.x)];
    let allY=[...y,...ekstrapolasiData.map(p=>p.y)];
    minX=Math.min(...allX); maxX=Math.max(...allX); minY=Math.min(...allY); maxY=Math.max(...allY);
    stepSizeX=Math.max(1,Math.round((maxX-minX)/30));
    stepSizeY=Math.max(1,Math.round((maxY-minY)/30));
    let showReg=document.getElementById("showRegression").checked;
    
    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("grafik"),{
        type:"scatter",
        data:{datasets:[
            {label:"Data Asli üíô",data:scatterData,backgroundColor:"#3b82f6",pointRadius:6},
            ...(showReg?[{label:"Titik Interpolasi üíö",data:titikRegresi,backgroundColor:"#22c55e",pointRadius:6},
            {label:"Garis Regresi ü§ç",type:"line",data:[{x:minX,y:a+b*minX},{x:maxX,y:a+b*maxX}],
             borderColor:"#FFFFFF",backgroundColor:"#FFFFFF",borderWidth:2,pointRadius:0}]:[]),
            ...(showReg && ekstrapolasiData.length>0?[{label:"Titik Ekstrapolasi üíõ",data:ekstrapolasiData,backgroundColor:"#FFFF00",pointRadius:6}]:[])
        ]},
        options:{responsive:true,maintainAspectRatio:false,
            scales:{x:{grid:{color:'white'},ticks:{stepSize:stepSizeX,callback:v=>Math.round(v)}},
                    y:{grid:{color:'white'},ticks:{stepSize:stepSizeY,callback:v=>Math.round(v)}}}
        }
    });
}

function tambahkanEkstra(){
    if(!a || !b){alert("Hitung regresi dulu ya! üíï"); return;}
    let x=Number(document.getElementById("xEkstra").value);
    if(isNaN(x)){alert("Masukkan nilai x yang valid! üå∏"); return;}
    let y=a+b*x;
    ekstrapolasiData.push({x:x,y:y});
    updateTabelEkstra(); hitung();
    document.getElementById("xEkstra").value="";
}

function updateTabelEkstra(){
    let tabel=`<table><tr><th>No</th><th>x</th><th>y ekstrapolasi</th><th>Aksi</th></tr>`;
    ekstrapolasiData.forEach((p,i)=>{
        tabel+=`<tr><td>${i+1}</td><td>${p.x}</td><td>${p.y.toFixed(3)}</td><td><button onclick="hapusEkstra(${i})" style="background:#ff2f92;width:auto;padding:5px 10px;">Hapus</button></td></tr>`;
    });
    tabel+=`</table>`;
    document.getElementById("tabelEkstra").innerHTML=tabel;
}

function hapusEkstra(i){ekstrapolasiData.splice(i,1); updateTabelEkstra(); hitung();}

const slider=document.getElementById("zoomSlider");
const container=document.getElementById("grafik-container");
slider.oninput=()=>{
    container.style.transform=`scale(${slider.value/100})`;
    document.getElementById("zoomValue").innerText=slider.value+"%";
};

document.getElementById("showRegression").addEventListener("change",hitung);

function resetGrafikOnly(){
    document.getElementById("tabel").innerHTML=""; document.getElementById("tabelRegresi").innerHTML="";
    document.getElementById("hasil").innerHTML=""; ekstrapolasiData=[]; updateTabelEkstra();
    if(chart){chart.destroy(); chart=null;}
}

function resetSemua(){
    dataX=[]; dataY=[]; ekstrapolasiData=[]; a=undefined; b=undefined;
    document.getElementById("xPoin").value=""; document.getElementById("yPoin").value=""; document.getElementById("xEkstra").value="";
    document.getElementById("tabelPoin").innerHTML=""; resetGrafikOnly();
    document.getElementById("zoomSlider").value=50; container.style.transform="scale(0.5)";
}
</script>
</body>
</html>
