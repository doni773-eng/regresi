<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Regresi Linier - Doni Stiawan, S.Mat</title>

<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box;}
body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    font-family: 'Quicksand', sans-serif;
    background-color: #050a14; color: #333; overflow-x: hidden;
}

/* --- BACKGROUND PARTIKEL (Gaya Kombinatorik) --- */
#canvas-bg {
    position: fixed; top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 1; display: block;
}

/* --- HALAMAN VALIDASI MENJEBAK --- */
#validation-page {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #050a14; z-index: 2000;
    display: flex; justify-content: center; align-items: center; text-align: center;
}
.val-card {
    background: rgba(15, 23, 42, 0.95); padding: 40px; border-radius: 20px;
    border: 2px solid #ff2f92; max-width: 450px; width: 90%;
    box-shadow: 0 0 30px rgba(255, 47, 146, 0.4);
    z-index: 2001;
}
.val-card h2 { color: #ff2f92; margin-bottom: 20px; }
.val-card p { color: white; font-size: 1.1rem; }
.btn-val-group {
    display: flex; justify-content: center; gap: 20px; margin-top: 30px;
    position: relative; min-height: 60px;
}
.btn-iya { background: #ff2f92; color: white; padding: 12px 25px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.3s; }
.btn-tidak { background: #475569; color: white; padding: 12px 25px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 1.1rem; position: absolute; transition: 0.2s ease; }

/* --- MAIN PAGE STYLES (SESUAI KODINGAN ASLI BAPAK) --- */
.overlay {
    position: relative; z-index: 10;
    min-height: 100vh; padding: 20px;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(8px);
    border-radius: 22px;
    max-width: 1100px;
    margin: 20px auto;
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.25);
    display: none; /* Hidden initially */
}
.overlay.show { display: block; }

h2{text-align:center;color:#ff2f92;margin-bottom:5px;}
.subjudul{text-align:center;font-weight:bold;margin-bottom:25px;font-size:1.9em;}
.subjudul::after{content:" üìà";}
label{font-weight:600;}
input{width:18%;padding:10px;border-radius:12px;border:1px solid #ccc;font-family:'Quicksand',sans-serif;}

button{
    background:#ff5fa2;color:white;border:none;padding:12px 18px;border-radius:14px;
    cursor:pointer;font-weight:700;box-shadow:0 6px 15px rgba(255,95,162,.5);
    transition: background 0.3s;
}
button:hover{background:#ff2f92;}

table{width:100%;border-collapse:collapse;margin-top:15px;background:white;border-radius:14px;overflow:hidden;font-size:1.5em;}
th,td{padding:10px;border:1px solid #ddd;text-align:center;}
th{background:#ffe0ef;font-size:1.2em;}
.section{margin-top:25px;padding:18px;background:#fff;border-radius:18px;box-shadow:0 8px 20px rgba(0,0,0,.12);}

/* KEMBALI KE ASLI BAPAK: */
#grafik-container{width:100%;padding:12px;background:black;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.25);transform-origin:top left;overflow: hidden;}
#hasil{font-size: 2em;font-weight: bold;color: #ff2f92;text-align: center;margin: 10px 0;}

@media(max-width:768px){
    .overlay{margin:10px;padding:15px;}
    h2{font-size:1.4em;}
    .subjudul{font-size:1.5em;}
    input{width:100%;margin-bottom:10px;font-size:18px;display: block;}
    button{width:100%;padding:18px;font-size:1.2em;}
    table{font-size:1.4em;overflow-x:auto;display:block;white-space:nowrap;}
    th,td{padding:12px;}
    .section{padding:20px;}
    #grafik-container{padding:10px;}
    .section input[type="number"]{display:block;width:100%;margin-bottom:10px;}
    .section button{margin-top:10px;}
    input[type="range"]{width:100%;height:10px;}
    label[for="showRegression"]{display:block;margin-top:10px;font-size:1.1em;}
    #hasil{font-size:1.8em;}
}
</style>
</head>
<body>

<canvas id="canvas-bg"></canvas>

<div id="validation-page">
    <div class="val-card">
        <h2>KONFIRMASI PENGGUNA</h2>
        <p>Apakah Anda menyukai matematika dan mengakui bahwa Bapak Doni adalah orang yang <b>Paling Ganteng ?</b> di dunia ini?</p>
        <div class="btn-val-group">
            <button class="btn-iya" onclick="prosesIya()">IYA, BETUL</button>
            <button id="btn-no" class="btn-tidak" onmouseover="moveNo()" onclick="moveNo()">TIDAK</button>
        </div>
        <p id="troll-msg" style="margin-top: 20px; color: #ff2f92; font-weight: bold; min-height: 25px;"></p>
    </div>
</div>

<div class="overlay" id="main-page">
    <h2>Perhitungan Regresi Linier</h2>
    <div class="subjudul">DONI STIAWAN, S.MAT</div>

    <div class="section">
    <h3>üìä Tambah Poin Data</h3>
    <input type="number" id="xPoin" placeholder="Masukkan nilai x">
    <input type="number" id="yPoin" placeholder="Masukkan y">
    <br><br>
    <button onclick="tambahPoin()">‚ûï Tambah Poin</button>
    <div id="tabelPoin"></div>
    <br>
    <button onclick="hitung()">‚ú® Hitung Regresi ‚ú®</button>
    <br><br>
    <button onclick="resetSemua()" style="background:#6b7280;">üîÑ Reset Semua Data</button>
    </div>

    <div class="section">
    <h3>üìä Tabel Perhitungan</h3>
    <div id="tabel"></div>
    </div>

    <div class="section">
    <h3>üí° Hasil Regresi</h3>
    <p id="hasil"></p>
    </div>

    <div class="section">
    <h3>üìà Tabel Nilai Regresi (Interpolasi)</h3>
    <div id="tabelRegresi"></div>
    </div>

    <div class="section">
    <h3>üîÆ Ekstrapolasi</h3>
    <input type="number" id="xEkstra" placeholder="Masukkan x">
    <br><br>
    <button onclick="tambahkanEkstra()">‚ûï Tambah Ekstrapolasi</button>
    <div id="tabelEkstra"></div>
    </div>

    <div class="section">
    <label>üîç Zoom Grafik:</label>
    <input type="range" min="50" max="150" value="50" id="zoomSlider">
    <span id="zoomValue">50%</span>
    <br><br>
    <input type="checkbox" id="showRegression">
    <label for="showRegression">Munculkan Garis Regresi</label>
    <br><br>
    <div id="grafik-container">
        <canvas id="grafik" height="320"></canvas>
    </div>
    </div>
</div>

<script>
// --- LOGIKA BACKGROUND (Garis Kuning) ---
const canvas = document.getElementById('canvas-bg');
const ctx = canvas.getContext('2d');
let particles = [];
function initBG() {
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    particles = [];
    for (let i = 0; i < 80; i++) {
        particles.push({
            x: Math.random() * canvas.width, y: Math.random() * canvas.height,
            vx: (Math.random() - 0.5) * 1, vy: (Math.random() - 0.5) * 1
        });
    }
}
function drawBG() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy;
        if(p.x < 0 || p.x > canvas.width) p.vx *= -1;
        if(p.y < 0 || p.y > canvas.height) p.vy *= -1;
        ctx.fillStyle = "#38bdf8";
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        for (let j = i + 1; j < particles.length; j++) {
            let p2 = particles[j];
            let dist = Math.sqrt(Math.pow(p.x-p2.x,2) + Math.pow(p.y-p2.y,2));
            if (dist < 120) {
                ctx.strokeStyle = `rgba(251, 191, 36, ${1 - dist/120})`;
                ctx.lineWidth = 0.8;
                ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
            }
        }
    });
    requestAnimationFrame(drawBG);
}
window.addEventListener('resize', initBG);
initBG(); drawBG();

// --- JEBAKAN ---
function moveNo() {
    const btnNo = document.getElementById('btn-no');
    const x = Math.random() * (window.innerWidth - 150) - (window.innerWidth / 2 - 75);
    const y = Math.random() * (window.innerHeight - 150) - (window.innerHeight / 2 - 75);
    btnNo.style.left = x + 'px'; btnNo.style.top = y + 'px';
}
function prosesIya() {
    document.getElementById('validation-page').style.display = 'none';
    document.getElementById('main-page').classList.add('show');
}

// --- KODINGAN ASLI BAPAK ---
let chart, a, b;
let dataX = [], dataY = [];
let ekstrapolasiData = [];
let minX, maxX, minY, maxY, stepSizeX, stepSizeY;

function tambahPoin(){
    let x = Number(document.getElementById("xPoin").value);
    let y = Number(document.getElementById("yPoin").value);
    if(isNaN(x) || isNaN(y)){ alert("Masukkan nilai x dan y yang valid! üå∏"); return; }
    dataX.push(x); dataY.push(y); updateTabelPoin();
    document.getElementById("xPoin").value = ""; document.getElementById("yPoin").value = "";
}

function updateTabelPoin(){
    let tabel = `<table><tr><th>No</th><th>x</th><th>y</th><th>Aksi</th></tr>`;
    dataX.forEach((x, i) => {
        tabel += `<tr><td>${i+1}</td><td>${x}</td><td>${dataY[i]}</td><td><button onclick="hapusPoin(${i})" style="background:#ff2f92;color:white;border:none;padding:5px 10px;border-radius:5px;">Hapus</button></td></tr>`;
    });
    tabel += `</table>`;
    document.getElementById("tabelPoin").innerHTML = tabel;
}

function hapusPoin(i){
    dataX.splice(i,1); dataY.splice(i,1); updateTabelPoin();
    if(dataX.length>=2) hitung();
    else{
        document.getElementById("tabel").innerHTML=""; document.getElementById("tabelRegresi").innerHTML="";
        document.getElementById("hasil").innerHTML=""; ekstrapolasiData=[]; updateTabelEkstra();
        if(chart){chart.destroy(); chart=null;}
    }
}

function hitung(){
    if(dataX.length<2){alert("Tambahkan minimal 2 poin data ya! üíï"); return;}
    let x=[...dataX], y=[...dataY], n=x.length;
    let sumX=0,sumY=0,sumX2=0,sumXY=0;
    let tabel=`<table><tr><th>No</th><th>x</th><th>y</th><th>x¬≤</th><th>xy</th></tr>`;
    for(let i=0;i<n;i++){
        let x2=x[i]*x[i], xy=x[i]*y[i];
        sumX+=x[i]; sumY+=y[i]; sumX2+=x2; sumXY+=xy;
        tabel+=`<tr><td>${i+1}</td><td>${x[i]}</td><td>${y[i]}</td><td>${x2}</td><td>${xy}</td></tr>`;
    }
    tabel+=`<tr><th>Œ£</th><th>${sumX}</th><th>${sumY}</th><th>${sumX2}</th><th>${sumXY}</th></tr></table>`;
    document.getElementById("tabel").innerHTML=tabel;

    b=(n*sumXY-sumX*sumY)/(n*sumX2-sumX*sumX);
    a=(sumY-b*sumX)/n;
    document.getElementById("hasil").innerHTML=`‚ú® <b>y=${a.toFixed(3)} + ${b.toFixed(3)}x</b> ‚ú®`;

    let tabelR=`<table><tr><th>x</th><th>y hasil regresi</th></tr>`;
    let titikRegresi=[];
    for(let i=0;i<n;i++){
        let yr=a+b*x[i];
        tabelR+=`<tr><td>${x[i]}</td><td>${yr.toFixed(3)}</td></tr>`;
        titikRegresi.push({x:x[i],y:yr});
    }
    tabelR+=`</table>`;
    document.getElementById("tabelRegresi").innerHTML=tabelR;

    let scatterData=x.map((v,i)=>({x:v,y:y[i]}));
    let allX=[...x,...ekstrapolasiData.map(p=>p.x)];
    let allY=[...y,...ekstrapolasiData.map(p=>p.y)];
    minX=Math.min(...allX); maxX=Math.max(...allX); minY=Math.min(...allY); maxY=Math.max(...allY);
    stepSizeX=Math.max(1,Math.round((maxX-minX)/30));
    stepSizeY=Math.max(1,Math.round((maxY-minY)/30));
    let showReg=document.getElementById("showRegression").checked;
    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("grafik"),{
        type:"scatter",
        data:{datasets:[
            {label:"Data Asli üíô",data:scatterData,backgroundColor:"#3b82f6",pointRadius:6},
            ...(showReg?[{label:"Titik Interpolasi üíö",data:titikRegresi,backgroundColor:"#22c55e",pointRadius:6},
            {label:"Garis Regresi ü§ç",type:"line",data:[{x:minX,y:a+b*minX},{x:maxX,y:a+b*maxX}],
             borderColor:"#FFFFFF",backgroundColor:"#FFFFFF",borderWidth:2,pointRadius:0}]:[]),
            ...(showReg && ekstrapolasiData.length>0?[{label:"Titik Ekstrapolasi üíõ",data:ekstrapolasiData,backgroundColor:"#FFFF00",pointRadius:6}]:[])
        ]},
        options:{responsive:true,maintainAspectRatio:false,
            scales:{x:{grid:{color:'white'},ticks:{stepSize:stepSizeX,callback:v=>Math.round(v)}},
                    y:{grid:{color:'white'},ticks:{stepSize:stepSizeY,callback:v=>Math.round(v)}}}
        }
    });
}

function tambahkanEkstra(){
    if(!a || !b){alert("Hitung regresi dulu ya! üíï"); return;}
    let x=Number(document.getElementById("xEkstra").value);
    if(isNaN(x)){alert("Masukkan nilai x yang valid! üå∏"); return;}
    let y=a+b*x;
    ekstrapolasiData.push({x:x,y:y});
    updateTabelEkstra(); hitung();
    document.getElementById("xEkstra").value="";
}

function hapusEkstra(i){ekstrapolasiData.splice(i,1); updateTabelEkstra(); hitung();}

function updateTabelEkstra(){
    let tabel=`<table><tr><th>No</th><th>x</th><th>y hasil ekstrapolasi</th><th>Aksi</th></tr>`;
    ekstrapolasiData.forEach((p,i)=>{
        tabel+=`<tr><td>${i+1}</td><td>${p.x}</td><td>${p.y.toFixed(3)}</td><td><button onclick="hapusEkstra(${i})" style="background:#ff2f92;color:white;border:none;padding:5px 10px;border-radius:5px;">Hapus</button></td></tr>`;
    });
    tabel+=`</table>`;
    document.getElementById("tabelEkstra").innerHTML=tabel;
}

const slider=document.getElementById("zoomSlider");
const container=document.getElementById("grafik-container");
const zoomValue=document.getElementById("zoomValue");

slider.oninput=()=>{
    let s=slider.value/100;
    container.style.transform=`scale(${s})`;
    zoomValue.innerText=slider.value+"%";
    if(chart && minX!==undefined && maxX!==undefined && minY!==undefined && maxY!==undefined){
        let zoomFactor=s*3;
        chart.options.scales.x.ticks.stepSize=Math.max(1,Math.round(stepSizeX/zoomFactor));
        chart.options.scales.y.ticks.stepSize=Math.max(1,Math.round(stepSizeY/zoomFactor));
        chart.update();
    }
};

document.getElementById("showRegression").addEventListener("change",hitung);

function resetSemua(){
    dataX=[]; dataY=[]; ekstrapolasiData=[]; a=undefined; b=undefined;
    document.getElementById("xPoin").value=""; document.getElementById("yPoin").value=""; document.getElementById("xEkstra").value="";
    document.getElementById("tabelPoin").innerHTML=""; document.getElementById("tabel").innerHTML="";
    document.getElementById("tabelRegresi").innerHTML=""; document.getElementById("tabelEkstra").innerHTML="";
    document.getElementById("hasil").innerHTML=""; document.getElementById("showRegression").checked=false;
    document.getElementById("zoomSlider").value=50; document.getElementById("zoomValue").innerText="50%";
    container.style.transform="scale(0.5)";
    if(chart){chart.destroy(); chart=null;}
}
</script>
</body>
</html>
